<?xml version="1.0" encoding="UTF-8"?>
<openerp>
	<data>
	
		<!-- Add Button to create User -->
        <record id="project_issue_form_view_inherited" model="ir.ui.view">
            <field name="model">project.issue</field>
            <field name="inherit_id" ref="project_issue.project_issue_form_view"/>
            <field name="arch" type="xml">
				<header>
				    <button name="pdsl_create_user" string="Create User" type="object"
                           states="open" groups="base.group_user" class="oe_highlight"/>
				</header>
            </field>
       </record>


		<!-- Categories -->
		<record id="project_category_support" model="project.category">
			<field name="name">support</field>
		</record>
		<record id="project_category_subscribe" model="project.category">
			<field name="name">subscribe</field>
		</record>
		<record id="project_category_confirm" model="project.category">
			<field name="name">confirm</field>
		</record>
		<record id="project_category_planimod" model="project.category">
			<field name="name">planimod</field>
		</record>
		<record id="project_category_minarca" model="project.category">
			<field name="name">minarca</field>
		</record>
		<record id="project_category_ekwos" model="project.category">
			<field name="name">ekwos</field>
		</record>
		<record id="project_category_rdiffweb" model="project.category">
			<field name="name">rdiffweb</field>
		</record>

		<!-- Task Stages -->
		<record id="project_tt_new" model="project.task.type">
			<field name="sequence">1</field>
			<field name="name">New</field>
			<field name="state">draft</field>
			<field name="case_default" eval="False" />
		</record>
		<record id="project_tt_waitconfirmation" model="project.task.type">
			<field name="sequence">2</field>
			<field name="name">Waiting for confirmation</field>
			<field name="state">pending</field>
			<field name="case_default" eval="True" />
		</record>
		<record id="project_tt_open" model="project.task.type">
			<field name="sequence">3</field>
			<field name="name">Open</field>
			<field name="state">open</field>
			<field name="case_default" eval="True" />
		</record>
		<record id="project_tt_done" model="project.task.type">
			<field name="sequence">100</field>
			<field name="name">Done</field>
			<field name="state">done</field>
			<field name="case_default" eval="True" />
			<field name="fold" eval="True" />
		</record>
		<record id="project_tt_cancel" model="project.task.type">
			<field name="sequence">200</field>
			<field name="name">Cancelled</field>
			<field name="state">cancelled</field>
			<field name="case_default" eval="True" />
			<field name="fold" eval="True" />
		</record>

		<!-- Projects -->
		<record id="project_project_pdsl_default" model="project.project">
			<field name="state">open</field>
			<field name="type">normal</field>
			<field name="name">Support</field>
			<field name="color">3</field>
			<field name="privacy_visibility">public</field>
			<field name="description">Used for support and subscriptions.</field>
		</record>

		<!-- We assign after so that default values applies -->
		<record id="project_project_pdsl_default" model="project.project">
			<field name="type_ids"
				eval="[(4, ref('project_tt_new')) ,(4,ref('project_tt_waitconfirmation')), (4,ref('project_tt_open')), (4,ref('project_tt_done')), (4,ref('project_tt_cancel'))]" />
		</record>

		<!-- Workflow -->
		<record id="pdsl_issue_workflow" model="workflow">
			<field name="name">pdsl.issue.workflow</field>
			<field name="osv">project.issue</field>
			<field name="on_create">True</field>
		</record>

		<record id="pdsl_issue_new" model="workflow.activity">
			<field name="wkf_id" ref="pdsl_issue_workflow" />
			<field name="flow_start">True</field>
			<field name="name">new issue</field>
			<field name="kind">function</field>
			<field name="action">pdsl_new_issue()</field>
		</record>
		<record id="pdsl_support_send_confirm" model="workflow.activity">
			<field name="wkf_id" ref="pdsl_issue_workflow" />
			<field name="name">send support confirm</field>
			<field name="kind">function</field>
			<field name="action">pdsl_send_confirm()</field>
		</record>
		<record id="pdsl_subscription_send_confirm" model="workflow.activity">
			<field name="wkf_id" ref="pdsl_issue_workflow" />
			<field name="name">send subscription confirm</field>
			<field name="kind">function</field>
			<field name="action">pdsl_send_confirm(subscription=True)</field>
		</record>
		<record id="pdsl_issue_confirmed" model="workflow.activity">
			<field name="wkf_id" ref="pdsl_issue_workflow" />
			<field name="name">confirmed</field>
			<field name="kind">function</field>
			<field name="action">pdsl_open()</field>
		</record>
		<record id="pdsl_issue_create_partner" model="workflow.activity">
			<field name="wkf_id" ref="pdsl_issue_workflow" />
			<field name="name">create partner</field>
			<field name="kind">function</field>
			<field name="action">pdsl_create_partner()</field>
		</record>
		<record id="pdsl_issue_create_user" model="workflow.activity">
			<field name="wkf_id" ref="pdsl_issue_workflow" />
			<field name="name">create Minarca user</field>
			<field name="kind">function</field>
			<field name="action">pdsl_issue_create_user()</field>
		</record>
		<record id="pdsl_issue_open" model="workflow.activity">
			<field name="wkf_id" ref="pdsl_issue_workflow" />
			<field name="flow_stop">True</field>
			<field name="name">open</field>
			<field name="kind">function</field>
			<field name="action">pdsl_open()</field>
		</record>


		<record id="trans_new_to_send_confirm" model="workflow.transition">
			<field name="act_from" ref="pdsl_issue_new" />
			<field name="act_to" ref="pdsl_support_send_confirm" />
			<field name="condition">message_ids and pdsl_is_support()</field>
		</record>
		<record id="trans_new_to_subscription" model="workflow.transition">
			<field name="act_from" ref="pdsl_issue_new" />
			<field name="act_to" ref="pdsl_subscription_send_confirm" />
			<field name="condition">message_ids and pdsl_is_subscription()</field>
		</record>
		<record id="trans_new_to_open" model="workflow.transition">
			<field name="act_from" ref="pdsl_issue_new" />
			<field name="act_to" ref="pdsl_issue_open" />
			<field name="condition">message_ids and not pdsl_is_subscription() and not pdsl_is_support()</field>
		</record>
		<record id="trans_confirm_to_open" model="workflow.transition">
			<field name="act_from" ref="pdsl_support_send_confirm" />
			<field name="act_to" ref="pdsl_issue_open" />
		</record>
		<record id="trans_confirm_to_create_partner" model="workflow.transition">
			<field name="act_from" ref="pdsl_subscription_send_confirm" />
			<field name="act_to" ref="pdsl_issue_create_partner" />
			<field name="condition">pdsl_is_confirmed()</field>
		</record>
		<record id="trans_confirm_to_create_user" model="workflow.transition">
			<field name="act_from" ref="pdsl_issue_create_partner" />
			<field name="act_to" ref="pdsl_issue_open" />
		</record>

	</data>
</openerp>
